"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getUnsupportedTargets = getUnsupportedTargets;
exports.default = exports.targetMetadata = void 0;

var _data = _interopRequireDefault(require("caniuse-db/fulldata-json/data-2.0.json"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// $FlowFixMe: Flow import error
// HACK: modern targets should be determined once at runtime
const targetMetadata = {
  targets: ['chrome', 'firefox', 'opera', 'safari', 'ie', 'edge', 'ios_saf', 'op_mini', 'android', 'bb', 'op_mob', 'and_chr', 'and_ff', 'ie_mob', 'and_uc', 'samsung', 'baidu']
};
exports.targetMetadata = targetMetadata;
const targetNameMappings = {
  chrome: 'Chrome',
  firefox: 'Firefox',
  opera: 'Opera',
  baidu: 'Baidu',
  and_qq: 'QQ Browser',
  safari: 'Safari',
  android: 'Android Browser',
  ie: 'IE',
  edge: 'Edge',
  ios_saf: 'iOS Safari',
  op_mini: 'Opera Mini',
  bb: 'Blackberry Browser',
  op_mob: 'Opera Mobile',
  and_chr: 'Android Chrome',
  and_ff: 'Android Firefox',
  ie_mob: 'IE Mobile',
  and_uc: 'Android UC Browser',
  samsung: 'Samsung Browser'
};
/**
 * Take a target's id and return it's full name by using `targetNameMappings`
 * ex. {target: and_ff, version: 40} => 'Android FireFox 40'
 */

function formatTargetNames(target) {
  return `${targetNameMappings[target.target]} ${target.version}`;
}
/**
 * Check if a browser version is in the range format
 * ex. 10.0-10.2
 */


function versionIsRange(version) {
  return version.includes('-');
}
/**
 * Parse version from caniuse and compare with parsed version from browserslist.
 */


function compareRanges(targetVersion, statsVersion) {
  return targetVersion === parseFloat(statsVersion);
}
/*
 * Check the CanIUse database to see if targets are supported
 */


function canIUseIsNotSupported(node, {
  version,
  target,
  parsedVersion
}) {
  const {
    stats
  } = _data.default.data[node.caniuseId];
  const targetStats = stats[target];
  return versionIsRange(version) ? Object.keys(targetStats).some(statsVersion => versionIsRange(statsVersion) && compareRanges(parsedVersion, statsVersion) ? !targetStats[statsVersion].includes('y') : false) : targetStats[version] && !targetStats[version].includes('y');
}
/**
 * Return an array of all unsupported targets
 */


function getUnsupportedTargets(node, targets) {
  return targets.filter(target => canIUseIsNotSupported(node, target)).map(formatTargetNames);
}
/**
 * Check if the node has matching object or properties
 */


function isValid(node, eslintNode, targets) {
  switch (eslintNode.type) {
    case 'CallExpression':
    case 'NewExpression':
      if (!eslintNode.callee) return true;
      if (eslintNode.callee.name !== node.object) return true;
      break;

    case 'MemberExpression':
      // Pass tests if non-matching object or property
      if (!eslintNode.object || !eslintNode.property) return true;
      if (eslintNode.object.name !== node.object) return true; // If the property is missing from the rule, it means that only the
      // object is required to determine compatibility

      if (!node.property) break;
      if (eslintNode.property.name !== node.property) return true;
      break;

    default:
      return true;
  }

  return !getUnsupportedTargets(node, targets).length;
}

const CanIUseProvider = [// new ServiceWorker()
{
  caniuseId: 'serviceworkers',
  astNodeType: 'NewExpression',
  object: 'ServiceWorker'
}, {
  caniuseId: 'serviceworkers',
  astNodeType: 'MemberExpression',
  object: 'navigator',
  property: 'serviceWorker'
}, // document.querySelector()
{
  caniuseId: 'queryselector',
  astNodeType: 'MemberExpression',
  object: 'document',
  property: 'querySelector'
}, // IntersectionObserver
{
  caniuseId: 'intersectionobserver',
  astNodeType: 'NewExpression',
  object: 'IntersectionObserver'
}, // PaymentRequest
{
  caniuseId: 'payment-request',
  astNodeType: 'NewExpression',
  object: 'PaymentRequest'
}, // Promises
{
  caniuseId: 'promises',
  astNodeType: 'NewExpression',
  object: 'Promise'
}, {
  caniuseId: 'promises',
  astNodeType: 'MemberExpression',
  object: 'Promise',
  property: 'resolve'
}, {
  caniuseId: 'promises',
  astNodeType: 'MemberExpression',
  object: 'Promise',
  property: 'all'
}, {
  caniuseId: 'promises',
  astNodeType: 'MemberExpression',
  object: 'Promise',
  property: 'race'
}, {
  caniuseId: 'promises',
  astNodeType: 'MemberExpression',
  object: 'Promise',
  property: 'reject'
}, // fetch
{
  caniuseId: 'fetch',
  astNodeType: 'CallExpression',
  object: 'fetch'
}, // document.currentScript()
{
  caniuseId: 'document-currentscript',
  astNodeType: 'MemberExpression',
  object: 'document',
  property: 'currentScript'
}, // URL
{
  caniuseId: 'url',
  astNodeType: 'NewExpression',
  object: 'URL'
}, // URLSearchParams
{
  caniuseId: 'urlsearchparams',
  astNodeType: 'NewExpression',
  object: 'URLSearchParams'
}, // performance.now()
{
  caniuseId: 'high-resolution-time',
  astNodeType: 'MemberExpression',
  object: 'performance',
  property: 'now'
}].map(rule => Object.assign({}, rule, {
  isValid,
  getUnsupportedTargets,
  id: rule.property ? `${rule.object}.${rule.property}` : rule.object
}));
var _default = CanIUseProvider;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wcm92aWRlcnMvQ2FuSVVzZVByb3ZpZGVyLmpzIl0sIm5hbWVzIjpbInRhcmdldE1ldGFkYXRhIiwidGFyZ2V0cyIsInRhcmdldE5hbWVNYXBwaW5ncyIsImNocm9tZSIsImZpcmVmb3giLCJvcGVyYSIsImJhaWR1IiwiYW5kX3FxIiwic2FmYXJpIiwiYW5kcm9pZCIsImllIiwiZWRnZSIsImlvc19zYWYiLCJvcF9taW5pIiwiYmIiLCJvcF9tb2IiLCJhbmRfY2hyIiwiYW5kX2ZmIiwiaWVfbW9iIiwiYW5kX3VjIiwic2Ftc3VuZyIsImZvcm1hdFRhcmdldE5hbWVzIiwidGFyZ2V0IiwidmVyc2lvbiIsInZlcnNpb25Jc1JhbmdlIiwiaW5jbHVkZXMiLCJjb21wYXJlUmFuZ2VzIiwidGFyZ2V0VmVyc2lvbiIsInN0YXRzVmVyc2lvbiIsInBhcnNlRmxvYXQiLCJjYW5JVXNlSXNOb3RTdXBwb3J0ZWQiLCJub2RlIiwicGFyc2VkVmVyc2lvbiIsInN0YXRzIiwiY2FuaXVzZVJlY29yZHMiLCJkYXRhIiwiY2FuaXVzZUlkIiwidGFyZ2V0U3RhdHMiLCJPYmplY3QiLCJrZXlzIiwic29tZSIsImdldFVuc3VwcG9ydGVkVGFyZ2V0cyIsImZpbHRlciIsIm1hcCIsImlzVmFsaWQiLCJlc2xpbnROb2RlIiwidHlwZSIsImNhbGxlZSIsIm5hbWUiLCJvYmplY3QiLCJwcm9wZXJ0eSIsImxlbmd0aCIsIkNhbklVc2VQcm92aWRlciIsImFzdE5vZGVUeXBlIiwicnVsZSIsImFzc2lnbiIsImlkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUVBOzs7O0FBREE7QUFtQkE7QUFDTyxNQUFNQSxjQUE4QixHQUFHO0FBQzVDQyxFQUFBQSxPQUFPLEVBQUUsQ0FDUCxRQURPLEVBRVAsU0FGTyxFQUdQLE9BSE8sRUFJUCxRQUpPLEVBS1AsSUFMTyxFQU1QLE1BTk8sRUFPUCxTQVBPLEVBUVAsU0FSTyxFQVNQLFNBVE8sRUFVUCxJQVZPLEVBV1AsUUFYTyxFQVlQ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LE9BRGI7QUFFRWlCLEVBQUFBLFdBQVcsRUFBRSxnQkFGZjtBQUdFSixFQUFBQSxNQUFNLEVBQUU7QUFIVixDQS9EbUMsRUFvRW5DO0FBQ0E7QUFDRWIsRUFBQUEsU0FBUyxFQUFFLHdCQURiO0FBRUVpQixFQUFBQSxXQUFXLEVBQUUsa0JBRmY7QUFHRUosRUFBQUEsTUFBTSxFQUFFLFVBSFY7QUFJRUMsRUFBQUEsUUFBUSxFQUFFO0FBSlosQ0FyRW1DLEVBMkVuQztBQUNBO0FBQ0VkLEVBQUFBLFNBQVMsRUFBRSxLQURiO0FBRUVpQixFQUFBQSxXQUFXLEVBQUUsZUFGZjtBQUdFSixFQUFBQSxNQUFNLEVBQUU7QUFIVixDQTVFbUMsRUFpRm5DO0FBQ0E7QUFDRWIsRUFBQUEsU0FBUyxFQUFFLGlCQURiO0FBRUVpQixFQUFBQSxXQUFXLEVBQUUsZUFGZjtBQUdFSixFQUFBQSxNQUFNLEVBQUU7QUFIVixDQWxGbUMsRUF1Rm5DO0FBQ0E7QUFDRWIsRUFBQUEsU0FBUyxFQUFFLHNCQURiO0FBRUVpQixFQUFBQSxXQUFXLEVBQUUsa0JBRmY7QUFHRUosRUFBQUEsTUFBTSxFQUFFLGFBSFY7QUFJRUMsRUFBQUEsUUFBUSxFQUFFO0FBSlosQ0F4Rm1DLEVBOEZuQ1AsR0E5Rm1DLENBOEYvQlcsSUFBSSxJQUNSaEIsTUFBTSxDQUFDaUIsTUFBUCxDQUFjLEVBQWQsRUFBa0JELElBQWxCLEVBQXdCO0FBQ3RCVixFQUFBQSxPQURzQjtBQUV0QkgsRUFBQUEscUJBRnNCO0FBR3RCZSxFQUFBQSxFQUFFLEVBQUVGLElBQUksQ0FBQ0osUUFBTCxHQUFpQixHQUFFSSxJQUFJLENBQUNMLE1BQU8sSUFBR0ssSUFBSSxDQUFDSixRQUFTLEVBQWhELEdBQW9ESSxJQUFJLENBQUNMO0FBSHZDLENBQXhCLENBL0ZtQyxDQUFyQztlQXNHZUcsZSIsInNvdXJjZXNDb250ZW50IjpbIi8vIEBmbG93XG4vLyAkRmxvd0ZpeE1lOiBGbG93IGltcG9ydCBlcnJvclxuaW1wb3J0IGNhbml1c2VSZWNvcmRzIGZyb20gJ2Nhbml1c2UtZGIvZnVsbGRhdGEtanNvbi9kYXRhLTIuMC5qc29uJztcbmltcG9ydCB0eXBlIHsgTm9kZSwgRVNMaW50Tm9kZSwgVGFyZ2V0cywgVGFyZ2V0IH0gZnJvbSAnLi4vTGludFR5cGVzJztcblxudHlwZSBUYXJnZXRNZXRhZGF0YSA9IHtcbiAgLy8gVGhlIGxpc3Qgb2YgdGFyZ2V0cyBzdXBwb3J0ZWQgYnkgdGhlIHByb3ZpZGVyXG4gIHRhcmdldHM6IFRhcmdldHNcbn07XG5cbnR5cGUgQ2FuSVVzZVN0YXRzID0ge1xuICBbYnJvd3Nlcjogc3RyaW5nXToge1xuICAgIFt2ZXJzaW9uOiBzdHJpbmddOiBzdHJpbmdcbiAgfVxufTtcblxudHlwZSBDYW5JVXNlUmVjb3JkcyA9IHtcbiAgZGF0YTogQ2FuSVVzZVN0YXRzXG59O1xuXG4vLyBIQUNLOiBtb2Rlcm4gdGFyZ2V0cyBzaG91bGQgYmUgZGV0ZXJtaW5lZCBvbmNlIGF0IHJ1bnRpbWVcbmV4cG9ydCBjb25zdCB0YXJnZXRNZXRhZGF0YTogVGFyZ2V0TWV0YWRhdGEgPSB7XG4gIHRhcmdldHM6IFtcbiAgICAnY2hyb21lJyxcbiAgICAnZmlyZWZveCcsXG4gICAgJ29wZXJhJyxcbiAgICAnc2FmYXJpJyxcbiAgICAnaWUnLFxuICAgICdlZGdlJyxcbiAgICAnaW9zX3NhZicsXG4gICAgJ29wX21pbmknLFxuICAgICdhbmRyb2lkJyxcbiAgICAnYmInLFxuICAgICdvcF9tb2InLFxuICAgICdhbmRfY2hyJyxcbiAgICAnYW5kX2ZmJyxcbiAgICAnaWVfbW9iJyxcbiAgICAnYW5kX3VjJyxcbiAgICAnc2Ftc3VuZycsXG4gICAgJ2JhaWR1J1xuICBdXG59O1xuXG5jb25zdCB0YXJnZXROYW1lTWFwcGluZ3MgPSB7XG4gIGNocm9tZTogJ0Nocm9tZScsXG4gIGZpcmVmb3g6ICdGaXJlZm94JyxcbiAgb3BlcmE6ICdPcGVyYScsXG4gIGJhaWR1OiAnQmFpZHUnLFxuICBhbmRfcXE6ICdRUSBCcm93c2VyJyxcbiAgc2FmYXJpOiAnU2FmYXJpJyxcbiAgYW5kcm9pZDogJ0FuZHJvaWQgQnJvd3NlcicsXG4gIGllOiAnSUUnLFxuICBlZGdlOiAnRWRnZScsXG4gIGlvc19zYWY6ICdpT1MgU2FmYXJpJyxcbiAgb3BfbWluaTogJ09wZXJhIE1pbmknLFxuICBiYjogJ0JsYWNrYmVycnkgQnJvd3NlcicsXG4gIG9wX21vYjogJ09wZXJhIE1vYmlsZScsXG4gIGFuZF9jaHI6ICdBbmRyb2lkIENocm9tZScsXG4gIGFuZF9mZjogJ0FuZHJvaWQgRmlyZWZveCcsXG4gIGllX21vYjogJ0lFIE1vYmlsZScsXG4gIGFuZF91YzogJ0FuZHJvaWQgVUMgQnJvd3NlcicsXG4gIHNhbXN1bmc6ICdTYW1zdW5nIEJyb3dzZXInXG59O1xuXG4vKipcbiAqIFRha2UgYSB0YXJnZXQncyBpZCBhbmQgcmV0dXJuIGl0J3MgZnVsbCBuYW1lIGJ5IHVzaW5nIGB0YXJnZXROYW1lTWFwcGluZ3NgXG4gKiBleC4ge3RhcmdldDogYW5kX2ZmLCB2ZXJzaW9uOiA0MH0gPT4gJ0FuZHJvaWQgRmlyZUZveCA0MCdcbiAqL1xuZnVuY3Rpb24gZm9ybWF0VGFyZ2V0TmFtZXModGFyZ2V0OiBUYXJnZXQpOiBzdHJpbmcge1xuICByZXR1cm4gYCR7dGFyZ2V0TmFtZU1hcHBpbmdzW3RhcmdldC50YXJnZXRdfSAke3RhcmdldC52ZXJzaW9ufWA7XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYSBicm93c2VyIHZlcnNpb24gaXMgaW4gdGhlIHJhbmdlIGZvcm1hdFxuICogZXguIDEwLjAtMTAuMlxuICovXG5mdW5jdGlvbiB2ZXJzaW9uSXNSYW5nZSh2ZXJzaW9uOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgcmV0dXJuIHZlcnNpb24uaW5jbHVkZXMoJy0nKTtcbn1cblxuLyoqXG4gKiBQYXJzZSB2ZXJzaW9uIGZyb20gY2FuaXVzZSBhbmQgY29tcGFyZSB3aXRoIHBhcnNlZCB2ZXJzaW9uIGZyb20gYnJvd3NlcnNsaXN0LlxuICovXG5mdW5jdGlvbiBjb21wYXJlUmFuZ2VzKHRhcmdldFZlcnNpb246IG51bWJlciwgc3RhdHNWZXJzaW9uOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgcmV0dXJuIHRhcmdldFZlcnNpb24gPT09IHBhcnNlRmxvYXQoc3RhdHNWZXJzaW9uKTtcbn1cblxuLypcbiAqIENoZWNrIHRoZSBDYW5JVXNlIGRhdGFiYXNlIHRvIHNlZSBpZiB0YXJnZXRzIGFyZSBzdXBwb3J0ZWRcbiAqL1xuZnVuY3Rpb24gY2FuSVVzZUlzTm90U3VwcG9ydGVkKFxuICBub2RlOiBOb2RlLFxuICB7IHZlcnNpb24sIHRhcmdldCwgcGFyc2VkVmVyc2lvbiB9OiBUYXJnZXRcbik6IGJvb2xlYW4ge1xuICBjb25zdCB7IHN0YXRzIH0gPSAoY2FuaXVzZVJlY29yZHM6IENhbklVc2VSZWNvcmRzKS5kYXRhW25vZGUuY2FuaXVzZUlkXTtcbiAgY29uc3QgdGFyZ2V0U3RhdHMgPSBzdGF0c1t0YXJnZXRdO1xuICByZXR1cm4gdmVyc2lvbklzUmFuZ2UodmVyc2lvbilcbiAgICA/IE9iamVjdC5rZXlzKHRhcmdldFN0YXRzKS5zb21lKFxuICAgICAgICAoc3RhdHNWZXJzaW9uOiBzdHJpbmcpOiBib29sZWFuID0+XG4gICAgICAgICAgdmVyc2lvbklzUmFuZ2Uoc3RhdHNWZXJzaW9uKSAmJlxuICAgICAgICAgIGNvbXBhcmVSYW5nZXMocGFyc2VkVmVyc2lvbiwgc3RhdHNWZXJzaW9uKVxuICAgICAgICAgICAgPyAhdGFyZ2V0U3RhdHNbc3RhdHNWZXJzaW9uXS5pbmNsdWRlcygneScpXG4gICAgICAgICAgICA6IGZhbHNlXG4gICAgICApXG4gICAgOiB0YXJnZXRTdGF0c1t2ZXJzaW9uXSAmJiAhdGFyZ2V0U3RhdHNbdmVyc2lvbl0uaW5jbHVkZXMoJ3knKTtcbn1cblxuLyoqXG4gKiBSZXR1cm4gYW4gYXJyYXkgb2YgYWxsIHVuc3VwcG9ydGVkIHRhcmdldHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFVuc3VwcG9ydGVkVGFyZ2V0cyhcbiAgbm9kZTogTm9kZSxcbiAgdGFyZ2V0czogVGFyZ2V0c1xuKTogQXJyYXk8c3RyaW5nPiB7XG4gIHJldHVybiB0YXJnZXRzXG4gICAgLmZpbHRlcih0YXJnZXQgPT4gY2FuSVVzZUlzTm90U3VwcG9ydGVkKG5vZGUsIHRhcmdldCkpXG4gICAgLm1hcChmb3JtYXRUYXJnZXROYW1lcyk7XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgdGhlIG5vZGUgaGFzIG1hdGNoaW5nIG9iamVjdCBvciBwcm9wZXJ0aWVzXG4gKi9cbmZ1bmN0aW9uIGlzVmFsaWQoXG4gIG5vZGU6IE5vZGUsXG4gIGVzbGludE5vZGU6IEVTTGludE5vZGUsXG4gIHRhcmdldHM6IFRhcmdldHNcbik6IGJvb2xlYW4ge1xuICBzd2l0Y2ggKGVzbGludE5vZGUudHlwZSkge1xuICAgIGNhc2UgJ0NhbGxFeHByZXNzaW9uJzpcbiAgICBjYXNlICdOZXdFeHByZXNzaW9uJzpcbiAgICAgIGlmICghZXNsaW50Tm9kZS5jYWxsZWUpIHJldHVybiB0cnVlO1xuICAgICAgaWYgKGVzbGludE5vZGUuY2FsbGVlLm5hbWUgIT09IG5vZGUub2JqZWN0KSByZXR1cm4gdHJ1ZTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ01lbWJlckV4cHJlc3Npb24nOlxuICAgICAgLy8gUGFzcyB0ZXN0cyBpZiBub24tbWF0Y2hpbmcgb2JqZWN0IG9yIHByb3BlcnR5XG4gICAgICBpZiAoIWVzbGludE5vZGUub2JqZWN0IHx8ICFlc2xpbnROb2RlLnByb3BlcnR5KSByZXR1cm4gdHJ1ZTtcbiAgICAgIGlmIChlc2xpbnROb2RlLm9iamVjdC5uYW1lICE9PSBub2RlLm9iamVjdCkgcmV0dXJuIHRydWU7XG5cbiAgICAgIC8vIElmIHRoZSBwcm9wZXJ0eSBpcyBtaXNzaW5nIGZyb20gdGhlIHJ1bGUsIGl0IG1lYW5zIHRoYXQgb25seSB0aGVcbiAgICAgIC8vIG9iamVjdCBpcyByZXF1aXJlZCB0byBkZXRlcm1pbmUgY29tcGF0aWJpbGl0eVxuICAgICAgaWYgKCFub2RlLnByb3BlcnR5KSBicmVhaztcblxuICAgICAgaWYgKGVzbGludE5vZGUucHJvcGVydHkubmFtZSAhPT0gbm9kZS5wcm9wZXJ0eSkgcmV0dXJuIHRydWU7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICByZXR1cm4gIWdldFVuc3VwcG9ydGVkVGFyZ2V0cyhub2RlLCB0YXJnZXRzKS5sZW5ndGg7XG59XG5cbmNvbnN0IENhbklVc2VQcm92aWRlcjogQXJyYXk8Tm9kZT4gPSBbXG4gIC8vIG5ldyBTZXJ2aWNlV29ya2VyKClcbiAge1xuICAgIGNhbml1c2VJZDogJ3NlcnZpY2V3b3JrZXJzJyxcbiAgICBhc3ROb2RlVHlwZTogJ05ld0V4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ1NlcnZpY2VXb3JrZXInXG4gIH0sXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICdzZXJ2aWNld29ya2VycycsXG4gICAgYXN0Tm9kZVR5cGU6ICdNZW1iZXJFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICduYXZpZ2F0b3InLFxuICAgIHByb3BlcnR5OiAnc2VydmljZVdvcmtlcidcbiAgfSxcbiAgLy8gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigpXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICdxdWVyeXNlbGVjdG9yJyxcbiAgICBhc3ROb2RlVHlwZTogJ01lbWJlckV4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ2RvY3VtZW50JyxcbiAgICBwcm9wZXJ0eTogJ3F1ZXJ5U2VsZWN0b3InXG4gIH0sXG4gIC8vIEludGVyc2VjdGlvbk9ic2VydmVyXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICdpbnRlcnNlY3Rpb25vYnNlcnZlcicsXG4gICAgYXN0Tm9kZVR5cGU6ICdOZXdFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdJbnRlcnNlY3Rpb25PYnNlcnZlcidcbiAgfSxcbiAgLy8gUGF5bWVudFJlcXVlc3RcbiAge1xuICAgIGNhbml1c2VJZDogJ3BheW1lbnQtcmVxdWVzdCcsXG4gICAgYXN0Tm9kZVR5cGU6ICdOZXdFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdQYXltZW50UmVxdWVzdCdcbiAgfSxcbiAgLy8gUHJvbWlzZXNcbiAge1xuICAgIGNhbml1c2VJZDogJ3Byb21pc2VzJyxcbiAgICBhc3ROb2RlVHlwZTogJ05ld0V4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ1Byb21pc2UnXG4gIH0sXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICdwcm9taXNlcycsXG4gICAgYXN0Tm9kZVR5cGU6ICdNZW1iZXJFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdQcm9taXNlJyxcbiAgICBwcm9wZXJ0eTogJ3Jlc29sdmUnXG4gIH0sXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICdwcm9taXNlcycsXG4gICAgYXN0Tm9kZVR5cGU6ICdNZW1iZXJFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdQcm9taXNlJyxcbiAgICBwcm9wZXJ0eTogJ2FsbCdcbiAgfSxcbiAge1xuICAgIGNhbml1c2VJZDogJ3Byb21pc2VzJyxcbiAgICBhc3ROb2RlVHlwZTogJ01lbWJlckV4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ1Byb21pc2UnLFxuICAgIHByb3BlcnR5OiAncmFjZSdcbiAgfSxcbiAge1xuICAgIGNhbml1c2VJZDogJ3Byb21pc2VzJyxcbiAgICBhc3ROb2RlVHlwZTogJ01lbWJlckV4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ1Byb21pc2UnLFxuICAgIHByb3BlcnR5OiAncmVqZWN0J1xuICB9LFxuICAvLyBmZXRjaFxuICB7XG4gICAgY2FuaXVzZUlkOiAnZmV0Y2gnLFxuICAgIGFzdE5vZGVUeXBlOiAnQ2FsbEV4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ2ZldGNoJ1xuICB9LFxuICAvLyBkb2N1bWVudC5jdXJyZW50U2NyaXB0KClcbiAge1xuICAgIGNhbml1c2VJZDogJ2RvY3VtZW50LWN1cnJlbnRzY3JpcHQnLFxuICAgIGFzdE5vZGVUeXBlOiAnTWVtYmVyRXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnZG9jdW1lbnQnLFxuICAgIHByb3BlcnR5OiAnY3VycmVudFNjcmlwdCdcbiAgfSxcbiAgLy8gVVJMXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICd1cmwnLFxuICAgIGFzdE5vZGVUeXBlOiAnTmV3RXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnVVJMJ1xuICB9LFxuICAvLyBVUkxTZWFyY2hQYXJhbXNcbiAge1xuICAgIGNhbml1c2VJZDogJ3VybHNlYXJjaHBhcmFtcycsXG4gICAgYXN0Tm9kZVR5cGU6ICdOZXdFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdVUkxTZWFyY2hQYXJhbXMnXG4gIH0sXG4gIC8vIHBlcmZvcm1hbmNlLm5vdygpXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICdoaWdoLXJlc29sdXRpb24tdGltZScsXG4gICAgYXN0Tm9kZVR5cGU6ICdNZW1iZXJFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdwZXJmb3JtYW5jZScsXG4gICAgcHJvcGVydHk6ICdub3cnXG4gIH1cbl0ubWFwKHJ1bGUgPT5cbiAgT2JqZWN0LmFzc2lnbih7fSwgcnVsZSwge1xuICAgIGlzVmFsaWQsXG4gICAgZ2V0VW5zdXBwb3J0ZWRUYXJnZXRzLFxuICAgIGlkOiBydWxlLnByb3BlcnR5ID8gYCR7cnVsZS5vYmplY3R9LiR7cnVsZS5wcm9wZXJ0eX1gIDogcnVsZS5vYmplY3RcbiAgfSlcbik7XG5cbmV4cG9ydCBkZWZhdWx0IENhbklVc2VQcm92aWRlcjtcbiJdfQ==